<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Loading Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>üß™ Library Loading Test</h1>
    <p>This page tests if PDF.js and Tesseract.js libraries are loading correctly.</p>
    
    <div id="pdfStatus" class="status info">üìÑ PDF.js: Loading...</div>
    <div id="tesseractStatus" class="status info">üîç Tesseract.js: Loading...</div>
    
    <div id="testResults"></div>
    
    <button id="testPdfBtn" disabled>Test PDF.js</button>
    <button id="testTesseractBtn" disabled>Test Tesseract.js</button>
    
    <script>
        // Load PDF.js with fallback
        function loadScript(src, fallbackSrc) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => resolve(src);
                script.onerror = () => {
                    console.warn(`Failed to load ${src}, trying fallback...`);
                    if (fallbackSrc) {
                        const fallbackScript = document.createElement('script');
                        fallbackScript.src = fallbackSrc;
                        fallbackScript.onload = () => resolve(fallbackSrc);
                        fallbackScript.onerror = () => reject(new Error(`Failed to load both ${src} and ${fallbackSrc}`));
                        document.head.appendChild(fallbackScript);
                    } else {
                        reject(new Error(`Failed to load ${src}`));
                    }
                };
                document.head.appendChild(script);
            });
        }

        // Load libraries with fallbacks
        Promise.all([
            loadScript(
                'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js',
                'https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js'
            ).then(() => {
                document.getElementById('pdfStatus').textContent = 'üìÑ PDF.js: ‚úÖ Loaded';
                document.getElementById('pdfStatus').className = 'status success';
                console.log('PDF.js loaded successfully');
            }).catch((error) => {
                document.getElementById('pdfStatus').textContent = 'üìÑ PDF.js: ‚ùå Failed';
                document.getElementById('pdfStatus').className = 'status error';
                console.error('PDF.js failed to load:', error);
            }),
            loadScript(
                'https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.0.5/tesseract.min.js',
                'https://unpkg.com/tesseract.js@5.0.5/dist/tesseract.min.js'
            ).then(() => {
                document.getElementById('tesseractStatus').textContent = 'üîç Tesseract.js: ‚úÖ Loaded';
                document.getElementById('tesseractStatus').className = 'status success';
                console.log('Tesseract.js loaded successfully');
            }).catch((error) => {
                document.getElementById('tesseractStatus').textContent = 'üîç Tesseract.js: ‚ùå Failed';
                document.getElementById('tesseractStatus').className = 'status error';
                console.error('Tesseract.js failed to load:', error);
            })
        ]).then(() => {
            console.log('All libraries loaded successfully');
            enableTestButtons();
        }).catch(error => {
            console.error('Failed to load libraries:', error);
        });

        function enableTestButtons() {
            if (typeof pdfjsLib !== 'undefined') {
                document.getElementById('testPdfBtn').disabled = false;
            }
            if (typeof Tesseract !== 'undefined') {
                document.getElementById('testTesseractBtn').disabled = false;
            }
        }

        // Test PDF.js functionality
        document.getElementById('testPdfBtn').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="status info">Testing PDF.js...</div>';
            
            try {
                if (typeof pdfjsLib === 'undefined') {
                    throw new Error('PDF.js not loaded');
                }
                
                // Test basic PDF.js functionality
                const version = pdfjsLib.version;
                const workerSrc = pdfjsLib.GlobalWorkerOptions.workerSrc;
                
                resultsDiv.innerHTML = `
                    <div class="status success">
                        <strong>PDF.js Test Passed!</strong><br>
                        Version: ${version}<br>
                        Worker Source: ${workerSrc || 'Not set'}
                    </div>
                `;
                
                console.log('PDF.js test passed:', { version, workerSrc });
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="status error">
                        <strong>PDF.js Test Failed!</strong><br>
                        Error: ${error.message}
                    </div>
                `;
                console.error('PDF.js test failed:', error);
            }
        });

        // Test Tesseract.js functionality
        document.getElementById('testTesseractBtn').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="status info">Testing Tesseract.js...</div>';
            
            try {
                if (typeof Tesseract === 'undefined') {
                    throw new Error('Tesseract.js not loaded');
                }
                
                // Test basic Tesseract.js functionality
                const version = Tesseract.version;
                
                resultsDiv.innerHTML = `
                    <div class="status success">
                        <strong>Tesseract.js Test Passed!</strong><br>
                        Version: ${version}
                    </div>
                `;
                
                console.log('Tesseract.js test passed:', { version });
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="status error">
                        <strong>Tesseract.js Test Failed!</strong><br>
                        Error: ${error.message}
                    </div>
                `;
                console.error('Tesseract.js test failed:', error);
            }
        });

        // Additional library info after 3 seconds
        setTimeout(() => {
            const resultsDiv = document.getElementById('testResults');
            let info = '<div class="status info"><strong>Library Information:</strong><br>';
            
            if (typeof pdfjsLib !== 'undefined') {
                info += `PDF.js: Available (v${pdfjsLib.version})<br>`;
            } else {
                info += 'PDF.js: Not available<br>';
            }
            
            if (typeof Tesseract !== 'undefined') {
                info += `Tesseract.js: Available (v${Tesseract.version})<br>`;
            } else {
                info += 'Tesseract.js: Not available<br>';
            }
            
            info += '</div>';
            resultsDiv.innerHTML = info;
        }, 3000);
    </script>
</body>
</html>
